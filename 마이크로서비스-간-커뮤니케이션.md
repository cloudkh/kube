e-Shop 시나리오에서 고객이 상품을 구매할 때 마다 상품에 설정된 point 값이 고객의 포인트에 누적되게 된다. 그러기 위하여 주문서비스를 통하여 주문 정보가 추가될 때 단순히 고객의 포인트를 누적한다고 보자. (물론, 배송이 이루어진 후 추가되는 것이 맞으나 시간상 주문 즉시 포인트가 추가된다고 본다)

# 로컬 호출로 두개의 서비스 간의 연결 (모놀로씩)

주문서비스와 고객서비스가 분리되기 이전에는 상품 구매에 따라 고객의 포인트를 누적시키는 작업은 다음과 같이 간단하게 처리 가능하다:

```java
public class Order implements BeforeSave{
    ....
    @Override
    public void beforeSave() {

        if(getCustomer()!=null && getItem()!=null)
            getCustomer().setPoint(getCustomer().getPoint() + getItem().getPoint());

    }
}
```

BeforeSave 인터페이스가 부여되면, 저장이 이루어지기 전에 해당 엔티티의 beforeSave() 메서드가 호출되도록 MultitenantRepository가 구현되어있어서, 저장 전에 해야 할 액션이 있다면 그 부분에 로직을 작성한다. 예제는 beforeSave()에 직접 Customer 엔티티를 얻어와서 바로 상품의 포인트 값을 합산하여 추가한다. 하나의 트랜잭션과 Spring Application Context 내에 존재하기 때문에 구현은 가장 간단하다 볼 수 있다. 



# 외부 호출로 서비스 연동 (동기식)

동기식으로 연동하는 방법은 말그대로 서비스에서 다른 서비스를 REST 호출 하는 것이다. 그나마 호출을 추상적인 방법으로 하는 방법으로 FeignClient 를 추천한다. FeignClient 는 REST 서비스의 추상화된 Stub interface 를 제공해주어 이를 기반으로 

```java
public class Order implements BeforeSave{
    ....
    @Override
    public void beforeSave() {

        if(getCustomer()!=null && getItem()!=null)
            getCustomer().setPoint(getCustomer().getPoint() + getItem().getPoint());

    }
}
```
